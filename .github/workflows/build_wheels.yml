# name: Build Wheels

# on:
#   push:
#     tags:
#       - 'v*'
#   workflow_dispatch:  # Manual trigger for testing

# permissions:
#   contents: write

# jobs:
#   # ==========================================================================
#   # Build wheels for all platforms and Python versions
#   # ==========================================================================
#   build:
#     name: Build ${{ matrix.platform.target }} - Py${{ matrix.python }}
#     runs-on: ${{ matrix.platform.os }}
#     strategy:
#       fail-fast: false
#       matrix:
#         platform:
#           # macOS Apple Silicon (M1/M2)
#           - os: macos-14
#             target: aarch64-apple-darwin
#           # macOS Intel
#           - os: macos-13
#             target: x86_64-apple-darwin
#           # Linux x86_64
#           - os: ubuntu-latest
#             target: x86_64-unknown-linux-gnu
#             manylinux: auto
#           # Linux ARM64 (for AWS Graviton, Raspberry Pi, etc.)
#           - os: ubuntu-latest
#             target: aarch64-unknown-linux-gnu
#             manylinux: auto
#           # Windows x86_64
#           - os: windows-latest
#             target: x86_64-pc-windows-msvc

#         python: ['3.8', '3.9', '3.10', '3.11', '3.12', '3.13']
        
#         exclude:
#           # Python 3.8 and 3.9 not available on macOS ARM64 runners
#           - platform:
#               os: macos-14
#             python: '3.8'
#           - platform:
#               os: macos-14
#             python: '3.9'

#     steps:
#       - name: Checkout
#         uses: actions/checkout@v4

#       - name: Set up Python ${{ matrix.python }}
#         uses: actions/setup-python@v5
#         with:
#           python-version: ${{ matrix.python }}

#       - name: Set up Rust
#         uses: dtolnay/rust-toolchain@stable
#         with:
#           targets: ${{ matrix.platform.target }}

#       - name: Cache Rust
#         uses: Swatinem/rust-cache@v2
#         with:
#           key: ${{ matrix.platform.target }}-${{ matrix.python }}

#       - name: Build wheel
#         uses: PyO3/maturin-action@v1
#         with:
#           target: ${{ matrix.platform.target }}
#           manylinux: ${{ matrix.platform.manylinux || 'auto' }}
#           args: --release --out dist -i python${{ matrix.python }}

#       - name: Upload wheel
#         uses: actions/upload-artifact@v4
#         with:
#           name: wheel-${{ matrix.platform.target }}-py${{ matrix.python }}
#           path: dist/*.whl
#           if-no-files-found: error

#   # ==========================================================================
#   # Build source distribution
#   # ==========================================================================
#   sdist:
#     name: Build sdist
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4
      
#       - name: Build sdist
#         uses: PyO3/maturin-action@v1
#         with:
#           command: sdist
#           args: --out dist
      
#       - name: Upload sdist
#         uses: actions/upload-artifact@v4
#         with:
#           name: sdist
#           path: dist/*.tar.gz

#   # ==========================================================================
#   # Create GitHub Release with all wheels
#   # ==========================================================================
#   release:
#     name: Release
#     needs: [build, sdist]
#     runs-on: ubuntu-latest
#     if: startsWith(github.ref, 'refs/tags/v')

#     steps:
#       - name: Download all artifacts
#         uses: actions/download-artifact@v4
#         with:
#           path: dist
#           pattern: wheel-*
#           merge-multiple: true

#       - name: Download sdist
#         uses: actions/download-artifact@v4
#         with:
#           name: sdist
#           path: dist

#       - name: List all files
#         run: |
#           echo "ðŸ“¦ Built distributions:"
#           ls -la dist/
#           echo ""
#           echo "Total files: $(ls dist/ | wc -l)"

#       - name: Create GitHub Release
#         uses: softprops/action-gh-release@v2
#         with:
#           files: dist/*
#           generate_release_notes: true
#           prerelease: ${{ contains(github.ref, 'alpha') || contains(github.ref, 'beta') || contains(github.ref, 'rc') }}
#           body: |
#             ## Installation

#             ### Install from this Release
            
#             Download the appropriate wheel for your platform and Python version, then:
#             ```bash
#             pip install jetxl-*.whl
#             ```

#             **Or install directly via URL (replace VERSION and cp3XX with your Python version):**

#             <details>
#             <summary>macOS (Apple Silicon - M1/M2) - Python 3.10-3.13</summary>

#             ```bash
#             # Python 3.10
#             pip install ${{ github.server_url }}/${{ github.repository }}/releases/download/${{ github.ref_name }}/jetxl-*-cp310-cp310-macosx_11_0_arm64.whl

#             # Python 3.11
#             pip install ${{ github.server_url }}/${{ github.repository }}/releases/download/${{ github.ref_name }}/jetxl-*-cp311-cp311-macosx_11_0_arm64.whl

#             # Python 3.12
#             pip install ${{ github.server_url }}/${{ github.repository }}/releases/download/${{ github.ref_name }}/jetxl-*-cp312-cp312-macosx_11_0_arm64.whl

#             # Python 3.13
#             pip install ${{ github.server_url }}/${{ github.repository }}/releases/download/${{ github.ref_name }}/jetxl-*-cp313-cp313-macosx_11_0_arm64.whl
#             ```
#             </details>

#             <details>
#             <summary>macOS (Intel) - Python 3.8-3.13</summary>

#             ```bash
#             # Replace cp312 with your Python version (cp38, cp39, cp310, cp311, cp312, cp313)
#             pip install ${{ github.server_url }}/${{ github.repository }}/releases/download/${{ github.ref_name }}/jetxl-*-cp312-cp312-macosx_10_12_x86_64.whl
#             ```
#             </details>

#             <details>
#             <summary>Linux (x86_64) - Python 3.8-3.13</summary>

#             ```bash
#             # Replace cp312 with your Python version (cp38, cp39, cp310, cp311, cp312, cp313)
#             pip install ${{ github.server_url }}/${{ github.repository }}/releases/download/${{ github.ref_name }}/jetxl-*-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl
#             ```
#             </details>

#             <details>
#             <summary>Linux (ARM64) - Python 3.8-3.13</summary>

#             ```bash
#             # Replace cp312 with your Python version (cp38, cp39, cp310, cp311, cp312, cp313)
#             pip install ${{ github.server_url }}/${{ github.repository }}/releases/download/${{ github.ref_name }}/jetxl-*-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl
#             ```
#             </details>

#             <details>
#             <summary>Windows (x86_64) - Python 3.8-3.13</summary>

#             ```bash
#             # Replace cp312 with your Python version (cp38, cp39, cp310, cp311, cp312, cp313)
#             pip install ${{ github.server_url }}/${{ github.repository }}/releases/download/${{ github.ref_name }}/jetxl-*-cp312-none-win_amd64.whl
#             ```
#             </details>
